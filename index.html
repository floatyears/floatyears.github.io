<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="专注于编程和图形">
<meta name="keywords" content="Graphics Program Game">
<meta property="og:type" content="website">
<meta property="og:title" content="Graphics Boy">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Graphics Boy">
<meta property="og:description" content="专注于编程和图形">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Graphics Boy">
<meta name="twitter:description" content="专注于编程和图形">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Graphics Boy</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Graphics Boy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/28/anxiety-disorder-after/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/28/anxiety-disorder-after/" itemprop="url">焦虑障碍-后记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-28T00:00:00+08:00">
                2020-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>创业的这两年多，从另一个角度来看，可以总结为一句话：花了一年的时间来得病，又花了一年的时间来痊愈。</p>
<h2 id="起始"><a href="#起始" class="headerlink" title="起始"></a>起始</h2><p>刚离职创业的那一年年初，读了叔本华的《人生的智慧》和《论道德与自由》，在认知上受到一些启发，整个人越来越平和，吃饭也香了，睡觉也沉了。但是《作为意志和表象的世界》基本看不懂，就没有继续，不过总算是在迷茫的时候用哲学提升了一下自己的认知。那时整个人状态很好，一度有点儿膨胀，感觉自己无所不能。回过头来看，那时的确是二十多年脑袋最灵光，思路最清晰，情绪感知力最强的时候。这也埋下一个坑，后来就为自己的傲慢付出了代价。刚刚创业那会儿，事情也不多，就给自己找了个活儿：把github上一个破解Unity的工具做得更加完善。一个多月内天天熬夜写这个工具，长时间坐着不动敲代码，导致腰部、背部和颈部的肌肉都有一定的劳损，同时耳鸣也开始了，但这些信号并没有引起我的警觉。从这里我做事情就有了一个坏习惯，一旦手上有工作，就想很快把它完成，白天做晚上做，累了也直接忽略。说得好听一点儿就专注，说得不好听一点儿，这种方式很容易积劳成疾。</p>
<p>这年十月底有朋友过来找我做小程序。换做以前我大概率直接拒绝，因为同时搞几件事情我自己hold不住，但那个时候膨胀，就接下来了。白天做项目的事，晚上回去就搞一搞小程序，很多时候还跟他讨论点子到十二点过。搞了两个月最后无疾而终，没出什么效果，还搭进去周末休息的时间，搞得自己有点儿累。这之后没过几天后果就来了，连续好几次快要睡着的时候，头突然一阵眩晕，感觉要炸了一样，起身坐一会儿缓解很多，但是早上起来就痛的厉害。想了好几天不知道原因，换了各种方式，比如换床睡、睡前点熏香，睡前拉伸，都不起作用。接着元旦节回成都的高速上，迎来了人生第一次惊恐发作和濒死体验。其实在产生头痛或者第一次惊恐发作的时候马上去就医可能会有不同的结果，但是那时并不清楚这些症状的含义，而且受父母影响，我习惯了在症状很轻的时候不去就医，扛一扛可能也就过了（大概每个人很难跳脱出父母和自己的局限性，或者说路径依赖）。现在来看，我的漂浮性焦虑就是从那时开始，同一时间内做好几件不同的事，对心智的负担很重，引起一种无明的焦虑，感觉每件事情都做不完，时时挂在心里。</p>
<h2 id="狂奔"><a href="#狂奔" class="headerlink" title="狂奔"></a>狂奔</h2><p>到了第二年一月又有几次惊恐发作，有一次看着电视突然就来了，心脏砰砰砰跳得很快，在屋里转了好几圈才平静下来。这个时候刚好项目迎来第一个版本收尾，要在春节前出一个相对完善的体验包。我还很清晰的记得放假前的那个晚上疯狂的加班。本来交给一个小弟的相对较大的系统，在验收测试时发现了非常多问题，基本上无法正常验收。我不得不从头到尾看一遍他的代码，然后重构了个底儿掉，从晚上8点到凌晨3点，大脑飞速运转，终于在第二天早上出了一个版本。从那之后，因为手下小弟不给力这个事情，导致我很多时候情绪都比较糟糕，每每看到他们写的屎一样的代码（虽然自己有时候写的也是屎，但是别人的屎闻起来总是更丑一些），一股无名火就上来了，训斥一顿，然后自己又拿来重构个底儿掉。这种情况持续了小半年，最后开掉一个小弟，情况稍微好转。现在想想，自己情绪在那段时间变坏了很多，每当生气就有一股气压在胸口无法排解，久而久之郁结于心。</p>
<p>到了五月份，惊恐发作的频率越来越高。后来每天都有一段时间出现心脏发紧，双手和双腿发麻的情况。白天坐在办公室敲代码，经常会禁不住想象自己坐在一辆奔驰的火车上，望向车厢的尽头，背心就一阵一阵的发麻，感到特别恐惧，总觉得前方会有一个莫名的东西快速向我冲来把我撞得稀碎。晚上睡在床上，有一种自己不断向下掉的感觉，坐立难安无法入睡。有一次凌晨1点实在睡不着，从29楼下到1楼才稍微有一点点安心。所有这些症状让我有点儿扛不住了，就百度了一下自己的症状，这才知道焦虑障碍，它普遍的症状就是怕高还有怕快。这时不得不去医院了，就在网上预约了一个华西的专家号。</p>
<p>医生开了一些常规的抗焦虑药物，阿普唑仑和阿戈美拉汀，在我没来得及多问两句的时候就让我滚蛋了。华西的医疗资源非常紧张，每个患者医生只会看5分钟左右，想多问几个问题医生就会撵你出去。那之后服药一个月，症状逐渐减轻，但是每次一想到那些恐惧的东西还是会坐立难安，只是带来的症状慢慢减轻。每当恐惧来袭，还是会有Fight or Run的反应，要么想一些让自己感觉安全的想法来对抗这种恐惧，要么迫使自己不去想那些让自己恐惧的东西。其实这两种方式其实都没什么卵用，该来的总会来，该走的也总会走。</p>
<p>这一年在项目上做了蛮多事情，开年的三个月在完善代码框架，很多地方不能适应现在的项目而进行重构，重构了整个项目一半多的代码。紧接着开始重写战斗系统，同时还有配套的技能编辑器，和战斗回放系统，这一写就是4个月到了10月。10月到第二年1月份这三个月，因为整个项目周期已经有一年半，投资人还没看到一个可以正常运行的游戏，开始不断地催进度。因为赶工还有重写战斗带来了很多bug，而且客户端只有两个人，并且没有一个测试，人手严重不足，很多测出来的问题无法去跟踪和复现，所有问题在这一阶段集中爆发。那段时间，一有人叫我名字就会感到心脏发紧，瞬间变得很烦躁，因为这表示又有新的bug或者需求来了。因为工作内容实在太多，所以这一年很多时候中午吃了饭要继续写代码，午休时间压缩到了二十来分钟，下午吃饭也是让同事带到办公司来，边吃饭边写代码，晚上下班了还要再写半个小时代码。刚吃完饭，血液都到了胃部，但我还是在强制自己工作，这就是用脑不卫生。好几次吃完饭就开始写代码，让我感到一阵阵眩晕。但是对自己身体的自信让我忽略了这些信号。这样做带来的后果就是病情越来越重，上下班路上，望向远处的高楼，会一阵一阵的害怕，害怕这个高楼突然向我砸过来，或者我突然飞出去砸到某个楼上。</p>
<p>年前的最后一个版本，做了最让我精疲力尽的一个系统之后，在春节终于迎来了最严重的惊恐发作。这个系统因为最终定稿的时间距离过年不到一周，需要3-5天做完，边开发还要边做一些优化，做完了马上体验，不合适的的地方马上就改，极短的工期压力和复杂的设计还有不断的改动，让我几近崩溃。虽然最终是做出来了，但它让我以后再也不想去碰类似的东西。这次惊恐发作，让我对地球在转动这个事情产生了恐惧。我妄图去寻找一个静止的点，但是地球在不断的自转，地球还在不断地绕着太阳转。这种想法让我在任何地方都不能感到安全，不管是在房间里还是大街上，不论是醒着还是在做梦，都会感受到恐惧，害怕地球转动过快把我甩出了地球，或者因为地球转动而某个东西突然朝我砸过来，在地上留下一条很深的沟壑。或许这是个很滑稽的事情，因为一个正常人无论怎么想象，都决不会对这些简单的事实感到害怕。这个时候我知道自己已经过渡到广泛性焦虑了。</p>
<p>春节因为新冠疫情在家呆了半个月，每天我都要花很大的精力来对抗恐惧，这次发作已让我无处可逃，在宇宙的任何一处都没有安全感。要么重复地想一些让自己感到安全的东西，或者从那些让我感到恐惧的东西中提取一些安全的出来，或者不断地给自己心里暗示：我很安全，我很安全········，每次对抗都让自己感觉精疲力尽，过两三个小时之后这种恐惧又会卷土重来，然后又开始对抗。各种灾难性联想，如果我连续想两三次，它就会变成实质性的恐惧，比如我在望向天空的时候，想着万一有个导弹突然飞过来把这个城市炸掉，然后我每次抬头望天都会感到害怕。</p>
<p>所有这些恐惧其实都很滑稽，正常人是一点感觉都没有的。比如你手背上有一条深深的伤口，但这个伤口是你现象出来的，你可以想象这个伤口会很痛，但却无法体会这个伤口真切存在时带来的痛楚，而且这个假想的伤口也并不会时不时地痛一下来提醒你它的存在。焦虑障碍就像是大脑受伤了，无法通过调整自己的想法来抵抗焦虑的来临，就像你不能通过自己的意志让手上的伤口愈合，只能静静等待它的痊愈。</p>
<p>持续服药到现在已经半年多了，但是情况在最近几个月反而边得更加严重。每次去华西复诊，只是问我病情怎么样，如果症状减轻就可以尝试减量。最后一次去的时候，我问医生如何才能完全康复，是不是需要辅助心理咨询。这个一级专家只是告诉我不要着急，一直服药就行了，看情况能不能逐渐减量，减量后如果病情加重就需要恢复剂量甚至加大剂量，要不要心理咨询看我自己，但是需要一个很长期的过程。我突然觉得这个医生不太靠谱，然后约了另外一个医生，一个月之后另外一个医生给我开了一大堆其他的药，没问几个问题就把我打发了。这时我意识到，在神经症方面，国内大部分医生还是只会给你用药，并无其他有建设性的意见，需要换个策略了。</p>
<h2 id="治疗"><a href="#治疗" class="headerlink" title="治疗"></a>治疗</h2><p>二月份经历了最难熬的一个月之后，我开始找一些治疗焦虑障碍方面的书籍，最开始买了《精神焦虑症地自救》这本书，它提到了以一种”飘然”的状态去面对恐惧，这本书有一定的作用但是很有限。期间身边的人都给了我一些建议，我才知道原来这个病症在很多人身上或多或少都出现过，但它每个人身上的表现都不一样，轻重程度不一样，恐惧的对象也不一样。有的人说不要去想它，过两天自己就好了；有的人说调节一下心情；有的人出现了症状，没多久症状莫名其妙就没了。每个人的经验其实没什么参考价值，因为都不一样。一个偶然的机会，在网上看到了某个医生推荐了一本书《走出焦虑风暴》，抱着试一试的心态买了回来。</p>
<p>这本书从心理学以及哲学或者佛学以及的角度讲了什么是焦虑症，还有调和身心焦虑的十五个策略。它提到了一种”退行机制”：<br>许多心灵在青春期或成年后不久，当一些深层愿望受挫或感到持久的应激压力时，自身的能量场处于持续被消耗的状态，这个时候更多的”阴气”（喻指消极的心念）也容易乘虚而入，此时有一些有焦虑情结的心灵会放弃已经学到的成熟态度和行为模式，而采用早年”较幼稚”的方式来宣泄自己的压力或部分欲望，这就叫退行。退行机制导致焦虑心灵在面对”症状”时怕成那种状态，更符合幼儿”幼稚性的情感反应模式”，而不是成年人的”成熟情感模式”，因为幼儿会害怕的东西，成年人通常都不会害怕，往往还会觉得好笑。有时候完全把自己的想象作为判断未知的依据，因此分不清幻想和现实。<br>曾经最严重的那一段时间，周围的一切变得越来越虚幻，爱人站在我面前都有一种不真实的感觉。那时我突然意识到，好像不论是什么事情都无法让我感到开心，那些那些让我内心感到愉悦的事情逐渐远去。对生活不再充满期待，我不再期待周末的到来，不再期望好天气，不再期望跑步和登山，不再期待外出旅行。这是一个非常危险的信号，必须要立即做出一些改变，再发展下去可能就变成抑郁症了。所以那时起，我就强迫自己把注意力从工作上分散一部分出来。</p>
<p>以前经常性地，到晚上九点还在啪啪啪不停敲代码，到九点半才回家，回家之后脑袋还嗡嗡作响，耳鸣特别严重。现在到8点半就逐渐开始放下手上地事情，让自己停下来休息。以前经常看不惯小弟的代码，总想自己去优化，现在我觉得只需要在关键的地方把好关，别人写得再不好，只要控制在很小的范围就OK。以前大部分的开发任务都压在我这里，因为我对组员不够信任，稍微有难度的我就自己上，现在就把大部分的逻辑开发任务都分出去，组员只有不停的犯错，他们的能力才会得到成长，我自己也相对轻松。以前没有测试，现在就不停要求补齐测试，不专业的测试对程序开发来说是个很大的负担，因为他们会提一些不知所以的bug，程序员需要自己去确认真正的bug是什么，然后再复现，最后才开始修bug。以前的工作流程不规范，现在就强烈要求规范工作流。不规范的工作流对处于末端的程序开发来说，压力是最大的。策划的案子晚两天，美术的UI晚一周，但是要求前端程序按时完成。服务器开发相对好一些，因为他们不用等待美术UI。所以经常性的在版本初期，程序无所事事，一到版本节点就开始疯狂加班。这个问题虽然提了很久，但是到现在改善也不大，不过尽量把这个问题对我的影响减到最小。以前满心满意扑在项目上，要么写代码，要么玩自己的游戏，基本上所有的社交和娱乐都大大减少，现在就找一些有意思的电视剧和游戏来充实一下休息的时间。</p>
<p>经过上面这些措施，大概每天都能感觉到自己在慢慢好转。虽然这是一个漫长的过程，而且中间会不断反复。《走出焦虑风暴》提到的习以治惊策略和律动螺旋定律对我初期的心态调整有很大帮助。习以治惊就是要习惯恐惧的到来，常见的”战或逃”都不是在习惯它。当自己能够平常对待它，久而久之这种恐惧就会远去。</p>
<blockquote>
<p>习以治惊（逆来顺受）就是一种见怪不怪，其怪自败的开放心态。简而言之，在我们拥有足够多的正见与定力前，不妨对焦虑先保持一种见怪不怪，其怪自败的心态。也即是说以一种开放的态度来觉知任何不舒适的感受，不要做任何判断，也不要拒绝和攀附这种感觉，而后自然地呼吸。不论是在禅悟中还是日常生活里，开放的觉察力都被认为是一种高等的治疗，不要让自己的心习惯性地奔向烦恼，或者排斥烦恼，单纯地让负面情绪存在，或许过一会儿他们就会飘走。如果它们不飘走，请温和地放松你的心，将你的心和焦虑的情绪气机融合到一起，安住在那感觉中，不管这感觉是什么，迎接它，不要加以任何批评，也不要在它们上面贴上标签——好与坏、证明与负面——让这些标签飘走，只是单纯地将觉性与感觉相融合。<br>……<br>当下就是未来与过去的真宰，你现在唯一能做的事情就是放弃掌控，那些不断升起的淫威（得失心）只是一层幻觉。<br>……<br>妄念频繁地光顾，其中有一个很重要地正面意图就是协助个体放下由于不了解自己的本来面目而创造出的不必要的内耗。<br>……<br>“律动”特指在一个存在的事物中必定会遵循的一个循环，这个循环就是“升起、发展、高潮、灭去”的过程，没有任何一样存在的实物可以脱离这个发展的规律。也可以称为“成、住、灭、空”。事物发展的过程必定是螺旋式前进。若能在高峰阶段提前抽离，学会伏一伏，低调地休养生息，那么就能在最大程度上保存自己的实力，也就不会在巅峰时期遭遇突然的变故或高处不胜寒的打击。事业停滞不前或缺乏动力时，恰恰是“老天爷”提示自我充电的最佳时机，如果能够利用这段相对低潮的时间潜心学习新资讯与新技艺，那么就一定有更多胜算在充满竞争与变数的职场中立于不败之地。<br>……<br>关于“反弹”这个现象，也是遵循了非常正常的律动螺旋原理：如果我们以前的生活中因某个充满执着的分别知见卡在了某个念头上，或卡在了某个想不通的事情上，攀附在胸口里的那股不平衡的“嗔气”就会将它输入潜意识。一段时间过去后，潜意识为了更好地提醒“主人“”拨正“错误地习性反应，会时不时地给他出这道题，看看他这次能得几分，如果”主人“还是依照旧有的解体方式（排斥、抗拒、患得患失），那么这道题的得分就会下降。当潜意识下一次再跑出来要求主人”考试“时，这个”主人“或许会更加恐惧。反之，如果潜意识给他出考题时（涌上之前的那股焦虑性能力），他便能够让自心的“无明识”少一些分别知见的干扰，那么潜意识就会觉得“主人”已经往正确的方向迈进了，就会给他打一次较高的分数。如果考20次，每次都能做到减少一些对症状的“分别心”，那么很快就会获得70分、75分、80分，届时，这个“症状”或许就已经完成了自己的“使命”，而后就会自讨没趣地溜走了。<br>…….<br>再狂妄的念头都会经过一个升起、高潮，然后痛痛快快灭去的过程。你唯一要做的就是对这一切“见怪不怪”，把暂时的躁动症状当成是非常平常的体验，就想感冒了自然会有头疼一样，只不过感冒的人都坚信症状很快就会环境，而这种信念正是你所需要的。<br>……<br>有的人出去爬山、游泳、行脚，这个过程也会缓解焦虑感，主要是这种身体力行的有氧运动，本身会内耗掉许多此前因为情绪波动所分泌出来并残留在体内的肾上腺素与皮质醇。已有越来越多的研究数据证实，这两种化学物质的过量分泌若没有及时分解掉或者内耗掉，长此以往对身心健康必定会造成一定的影响。<br>……<br>在这个世界上，任何冲突都是因为空间被挤压而造成的，包括国与国之间，人与人之间，而我们与烦恼之间也是因为过分的挤压与排斥，造成了内在空间的局促不堪。那么，在以充实生活为核心指南的前提下，每周务必腾出一些时间暂时放下一些工作上的欲求，放下一些尘氛，搁置对消除烦恼的执着心，同时也务必把一些无关紧要的东西请出内在空间，这样我们得以有机会进一步沉淀下来。每个人的心灵空间都是有限的，在相对一段时间内如果让过多的妄情和妄识涌入内在空间，它就会边得拥挤，以至于我们无法相对清明地培育正念与正能量。</p>
</blockquote>
<p>用了书中的很多方法和策略不断调整，收获了很多。每天上下班的路上，通过闭着眼睛骑很短一段路来测试自己每天的焦虑状态，如果在闭上眼睛或者睁开眼睛的那一刹那，感觉心慌和呼吸顿促，就说明今天焦虑状态比较高，同时也经常练习闭眼骑车来破坏自己的掌控心态（危险行为，请勿模仿）。在毕业工作以来，睡眠情况就不太好，经常醒来还是感觉很累。所以很长的一段时间都在调整自己的睡眠，但是情况没有得到很大改善。直到前年，有两三个月一直在看叔本华，那时内心非常宁静，睡眠情况便大大改善。但创业之后对这方面关注就少了，大部分的精力都在工作上，睡眠质量越来越差，直到焦虑症逐步加深，才真正开始反思这个问题。经过半年左右的调整，目前为止，情况得到了很大的改善。</p>
<h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>形成一个坏习性用了多久时间，那么改掉这个坏习性也要相同的时间。创业初期，以为可以在一年左右把项目做上线，把所有精力投入其中， 不再跟朋友聚餐，不再出去旅游，让内心空间受到很大的挤压。“超我”想大跨步前进，让我抛弃社交和娱乐，潜心于工作，力求完美，想以极大的投入得到高回报，但“本我”还在贪图享乐，原地踏步。这种撕裂给我带来一种无明的焦虑，或者漂浮性焦虑。</p>
<p>这个项目对我来说也是很大的挑战，大部分的东西都不能延用以前的代码或者经验，而且项目中后期很多功能的复杂性高，面临的问题多，不再是百度一下然后Ctrl C+Ctrl V就可以完成。大部分功能以前没有做过，时间上把控就不准确，要在期望的时间内完成，就要尽量压缩前期时间，这个时候就会很焦虑。现在有一句话很流行：<strong>跳出自己的舒适区</strong>，但是剩下半句没有说：<strong>离舒适区太远的地方是焦虑区</strong>，长期焦虑对身体非常有害。很多时候为了赶工，除了吃饭上厕所一坐就是一天，不顾自己的身体和大脑需要休息（在开始恢复期的那段时间，为了避免自己连续长时间坐着敲代码，特意设了个闹钟，强制自己一小时休息5分钟）。同时对自己的某种自信让我忽略了身体和大脑给我的信号，不注意用脑卫生（这让我想起那句话：弱小和未知不是生存的障碍，傲慢才是）。而且加班过多，运动时间变得很少，胖了几十斤，身体状态不复以前。有一次去练瑜伽，瑜伽老师说我神经紧绷，是不是工作和生活压力很大，我心有戚戚，当场就想再买两节课。</p>
<p>再加上是创业，有限的资金像一把达摩克利斯时时悬在头顶，不敢招工资太高的程序员（导致经常因为组员低质量的代码而发火），人员没有富余（需求一多，每个人都会被拉爆），甚至有的岗位能省则省（测试的工作完全丢给了程序），工期压力也大（有时候一天几催，令人头秃），多一个月就是几十万的钱在烧（投资人每天都在磨刀）。长期处于压力之中，身体会分泌很多肾上腺素和皮质醇（关于皮质醇，<a href="https://askthescientists.com/zh-hans/cortisol/" target="_blank" rel="noopener">《9个有关皮质醇的趣味知识》</a>，这篇有一句话说得很好：学会说不，拒绝虽然很困难，但不要承担超出能力范围的责任，避免超负荷并优先排序最重要的任务。），而加班导致运动缺少，这些激素没有得到释放，对睡眠产生很大影响。睡眠质量不好又会反过来造成情绪变坏，焦虑加重，形成恶性循环。所有这些内部和外部的因素，一起造成了之前的局面。<br>以前为了调整睡眠，尝试过很多方法：睡前点香薰，睡前冥想，戴耳塞（外面一有声音就睡不着）。但是效果不明显，而且经常反复，一直不得其法。经此一役，即使外面有吵闹，也可以很快入睡，而且很多时候自己想睡都能睡着，失眠的情况大大减少。在焦虑障碍以前，我的焦虑水平应该就高于一般人，所以睡眠对我来说是个不小的问题。如果没有捅破这层窗户纸，其实很难理解焦虑对睡眠的影响，因为稍高水平的焦虑已经是我的一部分。回想以前那段内心安宁的时光，也正是如此，内心不再焦虑，睡眠自然安好。</p>
<p>经常有人说：努力是一种天赋。之前看小米的10周年直播，雷军在16年小米销量暴跌时，亲自下场带队，早上9点上班，每天加班到凌晨一两点，人称“中关村劳模”。雷军当年是省状元，后来去了武大计算机，几经辗转去金山写WPS，最后坐上了金山的CEO，40岁又从金山出来创办了小米。既有天赋，又非常努力，这可能是草根能到的极限了。其实在高压力下，长时间高强度的工作，身体还能不出毛病，本身就是一种天赋。现在才明白，自己跟那些很厉害的人，差距是很大的，并不是所谓的“努力”能够弥补的。</p>
<p>人生有三重境界：看山是山；看山不是山；看山还是山。三十年岁月悠悠而过，也许过几年再看，这些经历是个契机，让自己能看清尘世的虚妄。但身处变化之中，谁也不清楚这些变化会带来什么。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/22/ios-appstore-verification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/22/ios-appstore-verification/" itemprop="url">iOS提审踩坑记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-22T00:00:00+08:00">
                2020-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近这段时间，因为某些不可抗力，iOS提审失败，被逼做马甲包。</p>
<h1 id="1、送审被拒历史："><a href="#1、送审被拒历史：" class="headerlink" title="1、送审被拒历史："></a>1、送审被拒历史：</h1><blockquote>
<p>App Store Connect</p>
<p>Dear Developer,</p>
<p>We identified one or more issues with a recent delivery for your app, “xxxx” . Please correct the following issues, then upload again.</p>
<p>ITMS-90809: Deprecated API Usage - New apps that use UIWebView are no longer accepted. Instead, use WKWebView for improved security and reliability. Learn more (<a href="https://developer.apple.com/&gt;documentation/uikit/uiwebview)" target="_blank" rel="noopener">https://developer.apple.com/&gt;documentation/uikit/uiwebview)</a>.</p>
<p>Though you are not required to fix the following issues, we wanted to make you aware of them:</p>
<p>ITMS-90683: Missing Purpose String in Info.plist - Your app’s code references one or more APIs that access sensitive user data. The app’s Info.plist file should contain a NSLocationWhenInUseUsageDescription key with a user-facing purpose string explaining clearly and completely why your app needs the data. Starting Spring 2019, all apps submitted to the App Store that access user data are required to include a purpose string. If you’re using external libraries or SDKs, they may reference APIs that require a purpose string. While your app might not use these APIs, a purpose string is still required. You can contact the developer of the library or SDK and request they release a version of their code that doesn’t contain the APIs. Learn more (<a href="https://developer.apple.com/documentation/uikit/core_app/protecting_the_user_s_privacy)" target="_blank" rel="noopener">https://developer.apple.com/documentation/uikit/core_app/protecting_the_user_s_privacy)</a>.</p>
<p>Best regards,</p>
<p>The App Store Team</p>
</blockquote>
<p>废弃API的引用，这个是SDK中引用的，升级SDK之后解决了此问题。邮件提示获取定位权限需要详细的说明，因为Unity在导出工程的iPhoneSensor.mm文件中使用了定位相关的API，如果确定游戏内没有使用定位功能，可以手动删掉这些API的引用（Unity最新的LTS版本对此进行了修正，不过在项目中后期升级Unity太过麻烦，所以选择手动删除相关API）。同时如果用到了这个权限，那么对此权限的使用说明要更加清晰，比如：</p>
<blockquote>
<p>iOS申请权限应说明用途.<br>反例 : “应用需要访问你的同意  才能访问相机”<br>正例 : “我们需要相机权限，才能保存您的游戏头像”</p>
</blockquote>
<p>这次拒审之后重头戏就来了，连续几次4.3，花了很大的精力来处理这个问题，庆幸的是最终过审了。</p>
<blockquote>
<ol start="4">
<li>3 Design: Spam<br>Guideline 4.3 - Design</li>
</ol>
<p><code>We noticed that your app provides the same feature set as other apps submitted to the App Store; it simply varies in content or language, which is considered a form of spam.</code></p>
<p>The next submission of this app may require a longer review time, and this app will not be eligible for an expedited review until this issue is resolved.</p>
<p>Next Steps</p>
<ul>
<li>Review the Design section of the App Store Review Guidelines.</li>
<li>Ensure your app is compliant with all sections of the App Store Review Guidelines and the Terms &amp; Conditions of the Apple Developer Program. </li>
<li>Once your app is fully compliant, resubmit your app for review.</li>
</ul>
<p>When creating multiple apps where content is the only varying element, you should offer a single app to deliver differing content to customers. If you would like to offer this content for purchase, it would be appropriate to use the in-app purchase API.</p>
<p>Alternatively, you may consider creating a web app, which looks and behaves similar to a native app when the customer adds it to their Home screen. Refer to the Configuring Web Applications section of the Safari Web Content Guide for more information.</p>
<p>Submitting apps designed to mislead or harm customers or evade the review process may result in the termination of your Apple Developer Program account. Review the Terms &amp; Conditions of the Apple Developer Program to learn more about our policies regarding termination.</p>
</blockquote>
<blockquote>
<p>Guideline 4.3 - Design</p>
<p><code>This app duplicates the content and functionality of other apps submitted by you or another developer to the App Store, which is considered a form of spam.</code></p>
<p><code>Specifically, this app appears to be identical to another app previously submitted under a terminated Apple Developer Program account.</code></p>
<p>Apps that simply duplicate content or functionality create clutter, diminish the overall experience for the end user, and reduce the ability of developers to market their apps.</p>
<p>The next submission of this app may require a longer review time, and this app will not be eligible for an expedited review until this issue is resolved.</p>
<p>Next Steps</p>
<ul>
<li>Review the Design section of the App Store Review Guidelines.</li>
<li>Ensure your app is compliant with all sections of the App Store Review Guidelines and the Terms &amp; Conditions of the Apple Developer Program. </li>
<li>Once your app is fully compliant, resubmit your app for review.</li>
</ul>
<p>Submitting apps designed to mislead or harm customers or evade the review process may result in the termination of your Apple Developer Program account. Review the Terms &amp; Conditions of the Apple Developer Program to learn more about our policies regarding termination.</p>
</blockquote>
<p>两次都是4.3，不过描述还是有很大差别的，可以只看前面一两行，后面都是格式回复。这两次提包，第一次是在机审被拒，第二次是在人工审核被拒。第二次有游戏登陆记录，所以确认是到了人工审核。人工审核被拒，应该是相同的游戏名，UI基本一样，直接就被拒审了。到这里已经毫无办法，常规手段肯定会被4.3，只有朝马甲包的方向尝试了。最气的是这个项目是第一次提审，也不知道跟谁撞车了，估计跟今年版号趋严有关，苹果大力打击马甲包，AppStore的审核标准可能提高了很多。</p>
<h4 id="2、混淆代码"><a href="#2、混淆代码" class="headerlink" title="2、混淆代码"></a>2、混淆代码</h4><p>修改了Unity的一个混淆工具的相关代码，把随机字母的形式改为了随机单词的形式，避免随机字母这种过于直白的混淆被拒审。万一AppStore的审核机制会分析代码的语义，发现类名是全大写或者全小写，而且完全不能组成一个单词，违背了一般的驼峰式或者下划线式的命名习惯，这个问题不得不考虑。</p>
<h4 id="3、混淆资源"><a href="#3、混淆资源" class="headerlink" title="3、混淆资源"></a>3、混淆资源</h4><p>资源名和路径都要混淆，并且资源计算的md5值要不同，资源的size也需要不同。因为Unity在AssetBundle文件头部存储了当前文件内所有资源的positon和size，所以要改变AB包的md5值和大小比较简单，只需要在AB包文件的尾部Append一部分随机长度的byte[]数组就可以了。</p>
<h4 id="4、隔离开发环境和打包环境"><a href="#4、隔离开发环境和打包环境" class="headerlink" title="4、隔离开发环境和打包环境"></a>4、隔离开发环境和打包环境</h4><p>网上很多说用不同的机器来打包，因为可操作性比较差，所以想了另外一个方式。创建一个新的用户，新用户可以较大程度上隔离之前的环境。删除这个用户内不相关的钥匙串证书，只保留打包需要的，AppleID也不要登陆。</p>
<h4 id="5、iOS预审核"><a href="#5、iOS预审核" class="headerlink" title="5、iOS预审核"></a>5、iOS预审核</h4><p>对比了WeTest和QuickSDK的iOS预审核功能，QuickSDK的功能相对更加完善，并且说明更加精准。<br>QuickSDK主要提到了几个点：<br>a. 打包的机器用户名要更加通用，比如admin和jenkins等无特征性用户。<br>b. 预审核提示在代码中发现了dlopen和dlsym。这个问题很奇怪，是在il2cpp导出文件中发现的dlopen和dlsym，最终定位到了MacProxy.cs这个文件，在Mono.Net命名空间中。如果导出一个空的Unity工程，不会发现这个文件被导出。然后在空工程中引入一个第三方zip库，在导出工程中出现了这个文件的il2cpp导出，猜测是这个库导致MacProxy.cs文件被导出。尝试在项目中删除zip库，导出后依然存在MacProxy.cs文件。那项目中不止一处会导致导出工程中包含这个引用，所以用删减代码的方式来去掉MacProxy.cs的导出是不可行的。看了一下MacProxy.cs这个文件，主要是mac下网络代理相关的功能。游戏内基本没有使用到相关的API，可能是某些关联的依赖导致这个文件被il2cpp导出，所以直接注释掉MacProxy.cs导出的cpp文件中的接口调用，同时修改里面的dlopen和dlsym字符串文本，避免在二进制搜索中找到这个字符串。</p>
<p>上面的组合拳一套下来，基本上也很难检测到相似的代码和资源了。不过苹果粑粑这种逼良为娼的行为，着实让人掉头发。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/19/anxiety disorder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/19/anxiety disorder/" itemprop="url">焦虑障碍</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-19T00:00:00+08:00">
                2020-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>三周前又有了一次惊恐发作，这次是因为爬山，到了山顶，心跳得很快，又看到了远方，感到地球转动，感觉自己脚下的土地在不由自主的移动，然后就发作了。</p>
<p>一开始症状不强，但是因为这种敏感源（地球转动）是无处不在的，所以经常性的会去想这个想法。然后症状在第三天就开始达到顶峰，达到顶峰的3-4天之后身体和大脑开始逐渐适应了这个想法，症状减轻。</p>
<p>尝试了很多方法来减轻，比如通过关联一个安全的想法到敏感源上（需要不断尝试不同的想法，最好找到一个能让自己在潜意识层面获得安全感的想法），获得了一开始的放松，大脑强制去想这个安全的想法，基本上在一天的大部分时间获得安宁。</p>
<p>虽然中间也有反复，但感觉自己这样之后可以好了很多，不过始终无法根除。逃避了这个恐惧，没有明显对象的恐惧就开始出现，没有由来的那种。我自身并没有克服这种恐惧，而是找了一个安全的想法来逃避它，它没有找到出口，就开始变成没有对象的恐惧。这种没有对象的泛性焦虑会让人处于一种具有背景底噪的那种焦虑之中，整个人状态都不太好。所以我会刻意的去想一想自己的敏感源，做一番斗争，每次斗争之后都能获得一段时间的平静。</p>
<p>惊恐刚发作的几天之内，症状很强烈，在这个阶段需要通过一些方式去回避，比如强迫自己不要去想，冥想是个不错的办法，关注自己的呼吸，在一呼一吸之间慢慢放松自己的身体，最剧烈的时候，我会摸着自己的脉搏，从1数到100，数完两三次之后基本就能平静下来。</p>
<p>等症状减轻之后，让自己恐惧的那个想法不再让身体起剧烈反应，会慢慢地变成一种底噪地形式存在。现在就开始了拉锯战，偶尔觉得自己占据了上风，感觉这个想法不再让自己有任何地不适，自己就跟完全好了一样，不过几个小时之后，这个想法又会回来，占据大脑，再次让自己变得恐惧，焦躁不安。</p>
<p>在这次惊恐发作之前，我大概有两个多月地时间处于这种状态，没有太大地不安，但就是处于一种低水平的焦虑。正好因为这次疫情，可以长时间地放松自己，得以有时间来真正审视自己的身体状况。在之前的一年多时间内，创业的紧张状态一直没办法得到缓解，就像一列高速奔驰的火车，车轮都已经跑得发红，但是没有办法停下来。这次刚好遇到疫情，可以给这列火车刹车，减速，对自己来说未尝不是一个契机。</p>
<p>之前也咨询过医生，这个病吃药时间要好久，医生没有给出具体的时间，只说每个人的情况不一样。我还问了医生要完全康复是不是需要进行一定的心理治疗，医生也没有给出具体的回答，只说心理治疗不是几次就会有效果的。对于这样的回答我并不满意，下次换个医生再试试。</p>
<p>今天上午看了一本书《精神焦虑症地自救》，提到了完全康复需要的几个步骤：面对、接受、飘然和等待。我觉得这可能是一个很好的切入点，仔细想了想，第一次的惊恐发作和上一次的惊恐发作其核心没有变。第一次是在高速上，冬天的时候，因为车里面的空调开得很大，很燥热，加上连续几个月没有休息好，就有了第一次惊恐发作，大概有持续了5秒钟左右的濒死感。上一次爬山是因为心跳很快，身体没有很好的识别是因为紧张还是气喘导致的心跳减速，又有了一次惊恐发作。这两次让我恐惧的点都是我所处的那个位置是移动的（车的移动和地球的转动），这么久以来我还是第一次思考让自己恐惧的到底是什么。之前的恐惧并没有真正意义上的去克服，所以后面这种恐惧还会以不同的形式表现出来。</p>
<p>当我真正去面对这种恐惧的时候，我发现其实是一种失控感，我没办法去控制车速（坐的别人的车，又是在高速上），也没办法去控制地球的转动。生活中有些东西超出了我的控制，这可能是让我恐惧的真正原因。那是什么时候我开对平常的这些事情产生了强烈的掌控欲，一旦有事情失控，我就开始恐惧了呢。大概就是创业之后，很多的事情等待着自己去做，每天的事情都很多，又希望快速地迭代，把整个游戏弄上线，工作负荷超出了自己的承受范围，加上加班很多缺少运动，身体就出现状况了。现在回过头一想，自己很多时候处于一种应激的状态在做事情，有时候精神状态不好，还通过喝咖啡的方式来让自己进入这种状态，虽然这种状态下的效率会比较高，不过这是一种竭泽而渔的工作方式。自己在这个过程中成长了很多，学到了很多东西，这个焦虑症也是对自己的警醒，注意调整好心态，坚持锻炼身体。我们一生当中，工作和生活状态都会面临很多改变，也可能是极其重大的改变，只有守住自己的本心，才能处理好各种各样的变化。</p>
<p>分析了自己的恐惧本身，就要慢慢练习去接受它。既然恐惧的根源在于失控的感觉，那就慢慢破坏自己对很多事情的控制欲。正如《精神焦虑症地自救》所说，只有当恐惧来临的时候，我们去直面这种恐惧，去审视它，分析它，才能做到真正意义上的接受，以飘然的状态，等待原来的那个自己回来。</p>
<p>以古人的一句话激励自己：天将降大任与斯人也，必先苦其心志，劳其筋骨，空乏其身，行拂乱其所为。愿自己无所畏惧，迎接生命的狂喜。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/29/unity-ui-modularize/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/29/unity-ui-modularize/" itemprop="url">UI模块化</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-29T00:00:00+08:00">
                2018-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>两个月前的一篇文章中提到了想做一个UI编辑器来简化UI方面的工作。UI代码编写是一个比较繁重但是并没有太高技术含量的东西，多年以来我都在想是不是有某种方法可以极大地简化这样地工作。后来有朋友说他们正在做UI模块化方面的工作，受到了启发，最近一段时间终于理出一些头绪，并且有时间来完成这个工具。初步迭代了几个版本，在项目中逐渐启用。目前在模块化了的UI中，一个UI类有1/3~1/2的代码可以通过工具生成，减少了相当一部分编码工作量。后续还会继续优化，最终目标是能有1/2~2/3的代码可以通过工具生成。</p>
<h4 id="UI组件"><a href="#UI组件" class="headerlink" title="UI组件"></a>UI组件</h4><p>每一个UI框架中都有很多UI组件，UI组件可以看作是面向普适问题的解决方案。在我看来，UI模块比UI组件要处于更上面的层级，因为它是面向特定问题域的解决方案。如果把写UI比做搭积木，UI组件就是积木的原材料——木头，UI模块则是一个个用木头削成了特定形状的积木。平时写UI，大部分时间都是从头开始写，把原材料（UI组件）削成不同形状的积木，然后再把积木搭成我们想要的样子。我们每次都要自己加工原材料，而加工出来的内容并没有得到很好的固化，变成以后我们可以拿来即用的通用模块。这是一个很浪费时间和精力的过程，并且在这个过程中只会增加我们技术的熟练度，不会增加我们技术的高度。作为一个程序员，要致力于把自己从事务性的工作中解放出来，更多的精力集中在开创性的工作上面。什么是事务性的工作呢，就是重复了三次以上的开创性工作。对Unity来讲，常用的UI框架是nGUI/uGUI，里面的UI组件则是UISprite，UILabel，UIButton，UIToggle等等，复杂一些就是UITable（列表），或者自己实现的循环列表，平时写UI打交道最多的就是这些东西。UI组件库为了满足最广泛的需求，都会设置异常多的可配置变量。比如文字，可以设置其字号、颜色、是否有描边、描边颜色等等。但在特定的项目中，所有UI上的字号可能只有2~3种，字体2~3种，颜色2~3种。这就是特定问题域，因为相对来说变量更少。我们可以设计一个设置字体的API，比如SetFontByType(UILabel label, FontTypeEnum ftEnum)，根据传入的类型来设置字体、字号、颜色以及字体效果，稍微灵活一点儿，把这些字体的变量通过配置的方式保存，要想增加或者修改某个样式直接改配置就行，比如SetFontByConfigID(UILabel label, int fontConfigID)。虽然上面的方法减少了在每个地方设置颜色的尴尬局面，但这样还不够，我们仍然在跟底层的UI组件打交道。还需要以更高的抽象层次来减少我们的事务性工作。</p>
<h4 id="模块制作"><a href="#模块制作" class="headerlink" title="模块制作"></a>模块制作</h4><p>我们把好多UI组件组合在一起，它就变成了一个初步的模块。设想一种应用场景，比如装备图标，它会显示装备的icon、等级、名字，这几个是基本的显示。如果这个图标在背包界面，它可能还会显示装备数量，如果它在角色界面，它可能还会显示是否绑定。一个看起来相似的东西，它在不同的界面可能会有不同的显示，但它们的交集会占到整个内容的80%或者更高，只有20%的内容在发生变化。比较容易想到的办法是，把所有的变化内容都放在一起，通过一个API来设置这些属性，比如SetEquipIconByWhere(EquipIconType eiType)，在背包界面隐藏“已绑定”，在角色界面隐藏数量的显示。但是这带另外一个问题，当我们的变化内容越来越多的时候，就会使得所有内容的全集变得非常巨大，可能会达到当前所需内容的300%。</p>
<p>需要解决的问题是，一个模块的大部分内容都是一致的，但每个地方都会存在些许的差异。不可能有差异的地方就再定义一个模块，排列组合下来就要爆炸。打个比方，定义了一个模块A，但是在不同的地方用的却是A1、A2、A3、A4、A5、A6，怎么去平衡这个问题呢。先要定义一个模块的全集，即A123456。但不同于上面那种在运行时处理这些差异的方法，把解决这些模块差异提前到“编译时”，这样就省去了运行时的开销。如何理解“编译时”，就是把模块的功能原子化，那每种情况都是这些原子的组合。不同的组合会有生成不同的代码实现，就像是一条指令对应了一个功能，指令的组合就变成了程序。</p>
<h4 id="定义输入"><a href="#定义输入" class="headerlink" title="定义输入"></a>定义输入</h4><p>模块制作好了，如何去利用这些模块呢。对程序的一种抽象是，定义好输入，就会产生特定的输出，我们无需关心中间过程。对于模块化来说也是这样，我们只需要定义好输入到模块内的数据，剩下的工作只需要调用一个API，比如SetUIModule_EquipItem(EquipData data)。模块的使用者只需要知道在何时调用这个API就OK，不用再多写一句代码。那模块是怎么知道该如何显示自身的内容呢，在图形化界面中搭建UI的时候就已经把模块的选项配置好，然后通过“编译”生成了SetUIModule_EquipItem(EquipData data)这个函数的详细实现。这就是对模块的抽象，定义好输入，就自动生成对应的函数。后面需要做的就是不断丰富模块库，可以拿来即用，到项目中后期，图形UI制作完毕的时候，代码也写完了一大半。</p>
<h4 id="更高的抽象"><a href="#更高的抽象" class="headerlink" title="更高的抽象"></a>更高的抽象</h4><p>上面说的是对数据的抽象，我们需要定义好输入模块的数据结构。我觉得更高一层是对行为的抽象，定义好数据结构，那么对这个数据进行操作的一系列行为也随之固化下来，因为特定的项目面向的总是特定的问题域，所以不会有随时都在变化的无数行为。比如定义了EquipData，那么对装备的行为就是拾取、穿戴、升级、升阶、融合等等。把融合行为做成模块的形式，那么只需要在装备融合按钮上绑定一个点击事件，然后调用EquipCombineBehavior()，接下来的事情就无需操心了。毕竟对游戏来说，也就是响应用户的输入行为。不过这个方向我个人还在摸索中，希望将来有一天能够实现这个功能，那样做游戏就轻松多了。</p>
<p>面向通用问题的解决方案是无法和面向特定问题的方案比效率的，因为特定问题的解决方案总是可以根据应用场景优化到极致。所以不能期望利用第三方插件可以把效率做到最高，总是需要针对项目中的特定问题和工作流去优化出一套最优的方案。UI模块化就不是一种通用工具，不能把它放到不同的项目直接使用，需要先做好一堆积木，然后才能用这些积木去搭出不同的形状。模块化的目的是尽量减少重复的劳动，有些东西只需要做一次，就可以在后续开发中简单地复用。</p>
<h4 id="最少冗余信息量"><a href="#最少冗余信息量" class="headerlink" title="最少冗余信息量"></a>最少冗余信息量</h4><p>如果两行代码的相似度超过70%，那么就可以把这两行代码看作带有冗余信息。我们经常性的会写很多相似度很高的代码，特别是在UI中，比如<code>UIEventListener.Get(btnClose).onClick = OnClickClose;</code><br>这里面有大部分的代码具有的信息量都是重复的，独一无二的信息只是btnClose，OnClickClose这个函数也可以看作是根据btnClose生成的唯一标识，所以其实只需要在UI里面把按钮名字标记为btnClose，就可以生成这些代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//field declare</span></span><br><span class="line"><span class="keyword">private</span> GameObject btnClose;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//field init</span></span><br><span class="line"><span class="keyword">this</span>.btnClose = transform.Find(<span class="string">"btnClosePath"</span>).gameObject;</span><br><span class="line">UIEventListener.Get(btnClose).onClick = OnClickClose;</span><br><span class="line">....</span><br><span class="line"><span class="comment">//function declare</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnClickClose</span><span class="params">(GameObject go)</span></span>&#123;</span><br><span class="line"><span class="comment">//functiontobeimplemented</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按照这个思路，就可以省去手写很多代码。 </p>
<h4 id="智能决策"><a href="#智能决策" class="headerlink" title="智能决策"></a>智能决策</h4><p>假定一个UI含有的信息量是恒定的，那么可以把所有这些信息量开放出来，交给使用者去设置，但是更好的做法是做到智能决策，程序自动设置这些信息，减少使用者设置这些信息带来的决策成本。比如一个物品背包，作为列表显示，就会有行数和列数，如果只做很基本的功能，就需要使用者自己设置要显示的行数和列数。但行数和列数其实跟背包的显示区域、背包格子大小，格子之间的间距很强的相关性。所以在制作背包UI的时候，行数和列数就已经被固定了下来，默认如果不设置行数和列数就使用计算出来的值（当然仍需保留相关接口以免出现特殊情况）。这样智能决策的地方多了就可以节省很多时间，而且bug也少比较容易查，因为人参与的地方越多就越容易出现bug，而且是莫名其妙的bug。</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>模块化带来的好处是，只定义输入数据，所有的实现都是生成的代码，对使用者来说这就是个黑盒，要优化或者改变里面的实现就非常方便。当然函数也有这样的作用，但是函数是运行时的，UI模块可以在做到在“编译时”去修改或者优化实现，即优化生成的代码。另外还能避免一个相同或者类似的东西，每个人写出来都不一样，特别是新手或者对项目不熟的程序员。</p>
<p><strong>虽然工具不能通用，但是背后的思路是可以通用的，逐渐积累一些可以在以后很多年都能用的解决问题的思路会收益良多。</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/03/running-marathon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/03/running-marathon/" itemprop="url">关于马拉松这件小事</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-03T00:00:00+08:00">
                2018-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前不久刚跑完人生中的第三场全程马拉松。</p>
<p>喜欢上跑步差不多快四年了，最初是为了排解情绪，自我的心理矛盾，无法接纳自己；与外界的心理矛盾，嫉妒不甘烦躁等等各种赶也赶不走的情绪。一场跑步下来，酣畅淋漓，大脑得以放松，从此就爱上了它。心情烦躁的时候，沿着河边一直跑，来回二三十公里，有时候甚至跑到半夜1点才回家。</p>
<p>到了第二年，总觉得一直这样跑还是得有一个目标，于是报了一个马拉松，半程不够尽兴，就直接上全程。那个时候刚好年底项目不忙也不忙，隔晚上就去跑步，短衣短裤出门就是一个冷战，在寒风中瑟瑟发抖。好在这样坚持了两个月，终于到了比赛的时间。都说全马最后五公里才是真正的开始，我觉得不完全准确。那一次跑步，大概25公里小腿开始抽筋，30公里脚底板疼得不行，因为平足的关系，疼痛曲线显得异常陡峭。跑过长距离的应该有经验，哪个地方开始疼痛，就会慢慢地借力，等我把脚掌的每一寸都借完了，挨到了37公里。加上第一次没有经验，补给吃得太多，岔气很严重。最后五公里，每一公里都是煎熬，跑过一块路标，脑子里面想的唯一一件事，就是看到下一块路标。终于跑过终点线，发现自己还跑进了4小时，忽然有一种升华了的感觉。从一开始跑步，到准备马拉松，最后跑出来的成绩还算不错。这是自己在工作和读书以外做的第一件周期最长的事情，从这一刻开始，人生有了不一样的变化。</p>
<p>马拉松于我最大的意义，是把我从负面循环的思维中解救出来。不管是在身体，亦或是性格，还是思考方式的改变，都是从第一场马拉松开始。负面循环，就是对自己不够自信-&gt;遇到问题容易放弃，消极对待问题-&gt;没有办法长期坚持做某些事件-&gt;很少有能够做好的事情-&gt;加剧自己的不自信。说到这里，处于这个循环中的人很少会意识到自己在这个循环中，因为不够自信而引起的低自尊反而会让人刻意的回避这些问题，一叶障目，不见泰山。而那些本来就自信阳光，能力很强的人，根本没有这种烦恼也无法体会。这个循环总要找到一个节点去把它打断，而我比较幸运地找到了跑步这样一种方式。</p>
<p>以前常常会感觉到累，精力不足，对很多事情提不起兴趣。跑步以后，改善很大。现在想来还是体质太差，从小到大除了读书很少干其他事情，更别说运动，十多年累积下来，身体已经差到一种地步。大脑就像是供电不足被降频的CPU，信息处理能力低下。跑步一年之后，精力慢慢恢复，对很周围事物的观察力在提升，想的事情更多更复杂，做事情的动力也很足。后来察觉到自己体态很差，溜肩驼背骨盆前倾，这些会导致肌肉长期紧张，也是疲惫感的重要来源。这些通过专门的运动还有平时的体态矫正得到改善，现在基本上很少出现精力不足的情况，除非是前一天晚上睡眠不好。睡眠这个事情，从第三年开始意识到自己睡眠质量很差，进行了长期的斗争。做过的一大堆改善睡眠的事情略过不表（前面的文章有提过），现在也会偶尔睡眠不佳，还是一有点儿声音就会醒，不过总体改善比较可观。对自己存在的这些问题，不会惊慌焦虑，也不会急于求成，它就是一件我需要去做的事情，一年，两年，三年，稳步进行，一定会得到改变，这种心态上的改变，也是跑步给予我的赠礼。</p>
<p>跳出了负面循环，人生才真正开始有一种坚定的意味。知道自己应该做什么，并且会成为什么样子，然后一步一步朝着目标前进，中途累了会停下来休息，体力恢复了，又继续上路。面临失败的时候，就去反思总结，而不会让自己掉入负面的漩涡，然后去尝试更多不同的解法，人生是一场马拉松，而不是百米短跑。虽然这几句话好像自己小学写的作文，但是真正有体会了，却是另外一番景象。如一位哲学家所说，别人写下的作品，就好似在沙滩上留下的一串足迹，我们可以跟着别人的足迹走，却不一定能看见作者所领略到的风景。</p>
<p>以前给自己的承诺是每年跑一次全马，一次不多也不少，刚好让我能够一直保持跑步这个事情，又不会因为经常跑步而占用太多的精力。毕竟重心还是在工作和生活。为什么不是半马？因为半马在我的舒适区内，一直呆在舒适区肯定会让我越来越懒，最后身体状况又会掉落到一个不能接受的程度。每一年花一到两个月准备马拉松，把自己从体能曲线的低谷拉回来，也是一件美事。运动是一个非常长远的事情，并不指望在几个月或者半年的时间内得到长期的收益，等五年、十年之后再来看，我应该会感谢自己当初做了跑步这么一个决定。</p>
<p><strong>我想，自己一辈子都要保持这个承诺。</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/17/months-work/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/17/months-work/" itemprop="url">近几个月的工作内容</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-17T00:00:00+08:00">
                2018-10-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这几个月的时间主要围绕着游戏框架的外围功能，完善各个部分的工具链，不得不说Python确实是个好东西。<br>主要的内容如下：</p>
<h4 id="1、配置表导出（excel-gt-binaray-json-xml）"><a href="#1、配置表导出（excel-gt-binaray-json-xml）" class="headerlink" title="1、配置表导出（excel -&gt; binaray/json/xml）"></a>1、配置表导出（excel -&gt; binaray/json/xml）</h4><p>包含基础类型的序列化，还有复杂类型struct，array，dictionary，array&lt;struct&gt;，dictionary&lt;key, struct&gt;。<br>游戏中主要用到的是binaray，但这不方便策划动态的修改或者利用svn比对之前的修改，需要以字符串的格式来存储（这是一开始没有考虑到的）。</p>
<h4 id="2、AssetBundle资源打包"><a href="#2、AssetBundle资源打包" class="headerlink" title="2、AssetBundle资源打包"></a>2、AssetBundle资源打包</h4><p>自己实现了一套资源打包的策略。不同于Unity 5.x及以上通过设置AssetBundle tag的方式（需要手工操作）来打包，而是设置一个Build目录，资源只要在Build目录就会打包，比较底层的依赖资源则放置在Build目录以外（以计算依赖资源的方式打包进去）。这样所有打包资源一目了然， 省去了手工操作的环节。不过同时带来的问题是依赖资源是以某种算法计算出来它属于哪个AssetBundle包，所以算法策略的选择很重要，这关系到后续热更新对AssetBundle包的校验，有可能在增加或者删除资源之后导致某个依赖资源从一个AssetBundle包移动到另外一个AssetBundle包。不过这样一来依赖需要自己管理AssetMainfest。</p>
<h4 id="3、网络层"><a href="#3、网络层" class="headerlink" title="3、网络层"></a>3、网络层</h4><p>其实网络层涉及到的内容不少，从协议文件（proto）转换为对应的类文件，每个协议类包含了自己的Encode和Decode实现。 同时还实现了Http和Socket两种通信机制。Socket通信，异步从buffer中获取数据时，要保证最小的内存分配（很多游戏框架就是随手new一个byte[], 然后调用Array.Copy(source-&gt;dest)）。Http通信，一般拿到的是JSON数据，需要反序列化为协议类的实例，而内存分配依然是很重要的考量依据。当然可以用第三方的JSON库，不过越是面向更普遍的需求，其性能就越低，越是面向特定的问题，就能把优化做到极致，所以选择一个合适的第三方库也不是那么随意。<br>网络层拿到数据需要派发到Model层，这里面隐含的一个问题是，在拿到巨量数据的时候，如何解决卡顿的问题。<br>socket协议解析过程大概有这么几步：<br><code>buffer-&gt;bytes[]-&gt;deserialization-&gt;dispatch to model</code><br>buffer到deserialization可以用缓存池和worker线程来缓解卡顿问题。dispatch to model可以用一个比较弹性的方式，每帧dispatch几条到model层。<br>大部分游戏框架不管拿到多少数据就是一通解，解完直接丢到逻辑层。单帧里面处理这么多内容必然造成卡顿。</p>
<h4 id="4、打包工具"><a href="#4、打包工具" class="headerlink" title="4、打包工具"></a>4、打包工具</h4><p>利用Python（避免了学习不同平台的shell以及windows 批处理<code>难看的</code>语法）结合Jenkins做了两个打包的流程，一个是打包AssetBundle，一个是打包Apk，打包Apk的可操作性非常大，如果是对接巨量的渠道，那么节省的工作量是难以想象的，享受到一键出包的快感。Jenkins真是解放程序员双手的利器。</p>
<h4 id="5、想做但是没做成的"><a href="#5、想做但是没做成的" class="headerlink" title="5、想做但是没做成的"></a>5、想做但是没做成的</h4><p>PSD to nGUI/ugui，市面上有很多插件和第三方工具，比如Fair GUI算是比较成熟的，不过它完全实现了一套自己的UI系统，现有的项目迁移过去比较麻烦。最大的难点在于让美术学习一套PS的图层命名规则，让别人学习并使用一套新的东西总是很麻烦。往往程序员自己写了一套工具给策划和美术使用，到最后都是自己在用。一部分原因在于工作流固定下来，要让大家跳出舒适区去用另外一套目前暂时看不到优势的东西比较困难，另一部分原因是工作内容的的安排使得持续开发并维护一个工具很难得到团队或者是老大的支持。</p>
<h4 id="6、未来想做的"><a href="#6、未来想做的" class="headerlink" title="6、未来想做的"></a>6、未来想做的</h4><p><strong>UI编辑器</strong>，现在大部分国产游戏都可以算是UI游戏，抛开核心战斗，差不多只剩下UI了。UI基本上都是以事件进行驱动，定义好所有的事件（用户事件和逻辑事件），然后以拖拽的方式对Model层的数据进行增删改查，同时提供接口读取Config层的数据，基本数据结构以proto的方式定义，Editor的编写可以参考ShaderForge，写好了又是解放双手的一大利器。效果类似于Unreal的Blueprints（或者微软WPF），可以用拖拽的方式进行部分代码编辑，当然这其中涉及到的模块非常有限（UI、Model、Config），所以编码难度也会小很多。有几个难点，如何在已经载入的UI上通过鼠标点击来进行操作，然后需要对操作得到的数据进行序列化和反序列化。<br><strong>DSL的序列化与反序列化</strong>（<a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank" rel="noopener">Domain Specific Language</a>）。任何特定的数据都可以用DSL来描述，JSON也算一种DSL，不过其数据表示仍然不够紧凑。可以根据特定的问题设计一种DSL，然后把这种DSL转换为运行时可识别的结构。考虑一种通用的方案，用JavaCC来扫描和解析这种DSL并转换为特定代码语言的解析器。<br><strong>思考各种能够流程化并且解放双手的环节</strong>，积累各种工具，并且工具要保证通用性，同时尽量能够可视化，还要方便地嵌入到开发流程中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/24/unity-game-performace-improvement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/unity-game-performace-improvement/" itemprop="url">Unity游戏性能优化实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-24T00:00:00+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分层"><a href="#分层" class="headerlink" title="#分层"></a>#<font color="grey">分层</font></h1><p>项目立项的时候就确定使用Lua来做热更新。Lua作为一种”胶水”语言在游戏领域被广泛使用，当然每个项目使用它的目的各不相同。Unity所用的C#本来也带有JIT（CLR会在第一次调用函数的时候将函数的IL编译成对应平台的机器码），可以实现热更新，奈何iOS禁止在其平台上使用JIT。所以大厂的引擎厂商无法提供全平台的热更新方案，只能开发者自己用Lua（iOS上也没有jit，只能解释执行）或者Python（没有编译器只有解释器）悄悄实现。</p>
<p>这样在Unity中就有了三层逻辑。Native层的C++，接口层的C#，还有上层逻辑的Lua。分层的好处显而易见，不必关心底层实现，而且C#的程序猿肯定比C++要便宜（同样的逻辑开发难度更小，上手更快）。但每层之间信息交换带来了非常大的开销，C#使用托管堆来管理，对象内存布局方式跟C++差异很大，大部分情况下无法共用同一份数据。如果一个复杂对象的列表要从C#传入到C++，那么C#会有一份列表，而C++也会有一份列表，这个列表就占据了两份内存，同时在传递列表的时候对列表的转换也会消耗巨量的CPU时间。</p>
<p>Lua和C#的信息交换略有不同，这跟ToLua的实现有关（项目中采用ToLua的方案）。ToLua有许多Wrapper文件，每个Wrapper文件中的Register方法会创建一个table，同时在这个table上以key-value的形式创建对应类的属性和方法，这个类型和table的映射关系保存在metaMap中，而table在C#中以reference（int）的形式展现。ToLua保存了一个objectsBackMap，作为在lua中访问的C#对象的映射关系，这是一个Dictionary&lt;object, int&gt;。先获得object的Type，然后获得Type对应的table，使用objectsBackMap中键值对的值（int类型）包装成一个userdata，这个userdata在创建时会指定一个metatable，而metatable便是object的Type对应的table。所以每个对象的方法调用会经历这么一个过程：在objectsBackMap查找对象的int值（没有就创建一个），利用这个int找到lua中对应的userdata数据，然后访问userdata的metatable来找到函数指针，接着指针又调用回了C#的函数，同时获取当前Lua栈上的数据作为C#函数的传入参数，并且Lua栈上获取到的数据需要进行类型转换。这样一个复杂的调用流程，造成的开销必然不小，但却无法避免。如果把userdata中的int值看做指针，metatable看做虚表，那这一部分的优化空间就非常有限。剩下可以考虑的是objectsBackMap在对象数量太过巨大时hash表查找所花费的时间，同时在回到C#中调用函数时参数的类型转换带来的开销。设想一种应用场景，比如一个UI，在UI的顶层用一个脚本保存当前UI所需访问的所有对象的字典，参数传递尽量采用int或者float，当UI销毁时，脚本开始GC，相关对象可以一并销毁。所以toLua中会尽量把可以展开的C#对象（struct类型如Vector，Matrix）都在lua层展开，能够在同一层里解决的问题，就不要垮层掉用，避免两层之间对象传递带来的开销。从策略上讲，sLua和toLua的解决方案类似，而且优化空间小。只能着眼于具体的应用场景进行优化，比如在UI或者独立的玩法逻辑中使用更加局部的方式。</p>
<p>以分层的方式，可以对整个游戏程序这样进行划分。磁盘（移动平台是闪存，这里为了方便统一称为磁盘）为一层，它的上面是内存，内存上面是CPU（缓存、寄存器、逻辑单元处理等等），另外显示部分有显存和GPU。每一层都有各自的特点，根据其特点选择合适的逻辑，同时要特别注意层与层之间信息交换的开销。</p>
<h1 id="磁盘"><a href="#磁盘" class="headerlink" title="#磁盘"></a>#<font color="grey">磁盘</font></h1><p>Unity存储在磁盘上的就是各种资源。Unity官方已经不推荐使用Resources.Load()的方式加载资源，所以假定全部资源都以AssetBundle的方式存在于磁盘上。为了优化包体大小，需要对AssetBundle进行压缩，但这样每次从磁盘上读取数据时都要解压，这是不必要的开销。所以大部分游戏在第一次运行时都会解压一次资源（从Application.streamingAssetsPath解压到Application.persistantPath），以后每次读取的是非压缩数据。从磁盘加载资源到内存，一般会用AssetBundle.LoadFromMemory(Async)和AssetBundle.LoadFromFile(Async)。LoadFromMemory(Async)会导致同一份资源占用三份内存，C#托管堆一份，native一份，显存一份，所以不推荐使用。AssetBundle.LoadFromFile(Async)会从磁盘上加载非压缩或者LZ4压缩格式的数据。Unity5.3之后开始引入LZ4压缩，可以对AB包中的每个资源进行分开压缩，这样就不必在读取一个资源时解压整个AB包。AB包数据分为两部分，头部信息和数据段。创建AB包的时候，只会初始化头部信息，只有在调用LoadAssets(LoadAssetsAsync)、LoadAllAssets(LoadAllAssetsAsync)、LoadAssetWithSubAssets(LoadAssetWithSubAssetAsync)之后才会加载对应资源的数据到内存。磁盘IO开销在很多情况下都会成为帧率抖动的元凶，这部分的优化不外乎异步，分帧，分时处理。底层调用异步接口，上层对资源加载做队列处理，这之上还可以做资源对象池。这样就可以把资源加载的IO平摊到多帧中进行，并且尽量把异步行为控制在下层，上层依然是同步的方式。</p>
<h1 id="内存"><a href="#内存" class="headerlink" title="#内存"></a>#<font color="grey">内存</font></h1><p>这部分可以分为三种情况：内存占用，内存峰值，内存泄漏。因为mono托管堆的特殊性，只增不减，所以控制好mono托管堆的峰值也需要加入考虑范围。之前遇到过这样的情况，对资源进行解压缩操作，一开始没有使用流式操作，会在mono堆上分配很大一块内存，造成内存占用降不下来，后来改成了流式处理就好了。而socket消息的内存开销也需要注意，一般会用两个buffer的互相切换来解析消息，避免每次解析都申请一个byte[]，造成消息堆积时出现内存峰值，同时还可以用池的方式缓存起来避免频繁gc。曾经遇到过某个消息太长超过一个buffer的长度而导致解析错误，对于消息最大长度也需要做限制。要对那些从native层获取一个数组信息的接口非常谨慎。我们之前使用了meshbaker这个插件来合并mesh降低drawcall。合并mesh会对顶点及其属性进行操作，这要在mono堆中分配很大一块内存，同时操作完毕还要传回navtive层，内存的开销和CPU开销都很大。这时候就要平衡drawcall减少和内存CPU开销了。这种情况可以考虑在native层解决，写一个native plugin，直接在c++中访问unity的接口和内存(既然il2cpp可以访问，那技术上是能实现的)，避免跨层的开销。这种情况也可以推及到lua，lua中的某些操作放到native层处理，比如用C对协议字节流进行解析并直接封装为lua对象。</p>
<p>说完mono堆内存占用，再说回navtive的内存占用，一般也策略上来进行规避。图片、mesh和动作这些占据了大头。图片选择合适的压缩格式，比如Android平台的ETC1,、ETC2，iOS平台的PVRTC，由于ETC1不支持alpha通道，PVRTC的RGBA压缩效果较差，可以分离贴图的alpha通道，而且alpha通道的贴图可以更大以换取更好的质量。贴图的Mipmap，增加内存（大约三分之一）以换取更好的显示效果（同时也会增加纹理采样时的cache miss），Read/Write Enable 会增加内存（无法直接修改显存内的纹理缓存，所以内存里面要保存一份copy），不同的纹理采样方式（一般使用双线性采样和三线性采样，各向异性采样很少用到），以及pixel shader内纹理的采样纹理的数量（纹理采样相当耗时并且对带宽影响很大）。mesh选择高模或者低模，LOD的使用，可以根据实际的项目需求实现一些LOD策略或者相机剔除策略。动作的采样和压缩方式，采样方式能够尽量还原fbx的动作曲线，如果觉得Unity的动作文件过大可以自己写插件从fbx导出动作采样曲线（我们项目尝试过，大小可以缩小三分之一）。这些都是技巧性的东西，不过对native内存占用影响较大。</p>
<p>关于内存泄露，自己代码造成的泄露倒是好查，但要特别注意Unity中某些实现机制，避免骚操作产生很多内存开销。之前遇到过一个神奇的bug，发现RenderTexture有泄露，思来想去只有屏幕后处理和阴影用到了RenderTexture（后面简称RT），不知道为啥泄露了。过了很久终于在Unity技术支持查看源码之后（公司买的服务，大概10w刀一年）发现是由于频繁修改Camera的pixelRect属性，而每次修改都会添加一个RT导致的，之前的RT不会立刻销毁，所以如果短时间多次修改pixelRect就会创建很多RT，内存狂涨。还有对材质的操作，每当访问了renderer的material属性，就会产生一个材质实例，所以对材质的访问和其属性修改都要谨慎。比如要控制UI上的特效层级，一般会修改材质的renderQueue属性，如果特效太多而且频繁开关UI就会导致出现成百上千个材质实例。</p>
<p>Profiler时我们要对每一帧的gc都做到了如指掌，哪些是可以减少的，哪些是可以避免的。</p>
<h1 id="CPU和GPU"><a href="#CPU和GPU" class="headerlink" title="#CPU和GPU"></a>#<font color="grey">CPU和GPU</font></h1><p>CPU和GPU之间的信息交互，以及各自对信息的处理都会对帧率有很大影响。首先从drawcall和batch说起。一次drawcall就是CPU调用一次图形绘制API。在以前这些API的调用会对CPU产生不少overhead，所以优化的目标就是减少drawcall数量。不过新的图形API在这上面的开销越来越小，Unity也有意弱化drawcall的概念，改为batch。一个batch就是一个提交图形管线的批次，同一个batch内的管线状态是不变的，如果状态改变，就变为不同的批次。使用相同的材质连续提交才会在一个batch内。很多技巧都集中在这两点上：尽量使用同一个材质，并且保证连续提交到管线。Unity提供了static batch和dynamic batch来合批。static batch会把mesh合并成一个大的mesh，首先是内存的开销，合并后的mesh和合并前的mesh都在内存中。其次是相机裁剪，合并后的mesh一般覆盖范围较大，不能被相机整个裁减掉，而三角形的裁剪已经在管线靠后的阶段了，造成额外的性能开销。dynamic batch会实时地合并mesh，这同时有CPU和内存开销，所以Unity也只合并总顶点属性少于900的mesh（粒子系统大部分情况下会使用动态合批）。并没有一种万能的优化方法，都是在特定的条件下平衡各种情况选择一种合适的方案。</p>
<p>阴影的实现过程堪称曲折，一开始的方案为了减少drawcall，使用低模来专门做投影，并用mesh baker合并这部分阴影mesh。这样做的好处是drawcall少了，所有阴影渲染只有一个drawcall，但是带来了新的问题，一是蒙皮的开销（多了新的mesh），还有合并mesh的开销，而且这部分工作在C#中完成造成开销过大。后来平衡了一下，场景内的模型减面，然后用同一个模型来投影和正常显示。这个时候投影的模型采用了正常显示的shader来渲染，所以用Camera.SetReplacementShader这个方法将阴影相机用纯色shader渲染。同时用projector的方式自行调整shadow map的大小并且选择需要投影的范围。一开始参考unity的一些优化建议，却不能无脑使用，然后不断profiler发现性能瓶颈，逐渐调整，达到平衡。</p>
<p>iOS下面用Instrument查看每一帧的shader开销，哪些shader开销过大，可以怎么精简，哪些计算可以从pixel shader提前到vertex shader。部分计算还可以缓存为纹理（比如一些高次方函数），直接采样结果值，以空间换时间。最近网上看到一个类似于GPU skinning的方案就是典型的空间换时间。把动作中每一帧内模型的顶点位置缓存在纹理中，在顶点着色器通过纹理采样获得本地坐标，而不是在CPU中用骨骼蒙皮计算。当然限制就是需要支持在vertex shader中采样纹理，并且无法实现动作融合。</p>
<p>还有热点函数的定位和优化。对于计算密集型，可以另开一个线程来实现，还可以下放到底层。如果lua实现效率低，可以考虑用C#实现，甚至用C/C++。对于IO密集型，前面提到过，可以分帧分时处理，还可以增加内存池。</p>
<p>这里仅列出了项目优化过程中遇到的一些典型问题（都可以百度到），当然还有很多很多其他的优化技巧，光是Unity官方网站就有很多干货。看文档不难，难的是了解每种技巧的优缺点及其适用范围。只有不断积累经验才知道在什么情况下选择合适的解决方案。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/04/thoughts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/04/thoughts/" itemprop="url">琐思小记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-04T00:00:00+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="序"><a href="#序" class="headerlink" title="#序"></a>#<font color="grey">序</font></h1><p>三月的成都，夏天来得迅猛而又热烈，一丝躁动和不安在空气中弥漫，冬日的平静和怡然悄悄远去。躁动来自于气候的升温，不安来自于年龄的稳步向前。第一次听到『季节性情绪障碍』这个词，就有一种似成相识的感觉，开始关注自己春夏秋冬的情绪更迭。说有『障碍』可能不贴切，也没到那种程度，只是认知和情绪随着季节的更替而周期性波动。秋冬更易心境平和，适合需要静心的工作，做长周期的事情，比如看书和学习；春夏更躁动而跃跃欲试，适合做短周期的事情，比如健身和动手写一个小项目之类。认识到这一点，就不会诘问自己为什么夏天静不下心来看书，冬天为什么毫无冲劲。三年时间实践下来，确实收获不少，因为夏天很少有看叔本华的心境，所以选择在对的时间做对的事。</p>
<h1 id="与这个世界和解"><a href="#与这个世界和解" class="headerlink" title="#与这个世界和解"></a>#<font color="grey">与这个世界和解</font></h1><p>之前看了一篇文章，说的是台湾的死亡赌局，把父母的死期作为赌注来赚钱。有时一想这个世界太险恶了，什么残忍的恶毒的事情都有，哀叹上天的不公，社会的不平。如今网络上的戾气越来越重，看到这些不平事，无法排解，因为越是负面和激烈的东西，越容易引出人的情绪。『天地不仁，以万物为刍狗』，人或许把自己想得太神圣化了。一切的一切，都是规律，没有怜悯和悲伤，也没有非黑即白、善恶美丑的对立，这是一元的思维方式。有一句是这样，成年人的世界不分对错，只有立场。每个人站在自己的立场上，顺应世界的规律在运行。重要的不是分清对错，而是找出这个世界的规律。当然不是说对这些事情冷漠，同情心属于道德范畴，这个世界要运转良好需要依靠道德，所以每个人都需要基本的道德，这也是规律。越长大，越要脱离情绪或者情感的束缚变得神圣化，这才有助于我们看清事物的本质。很多人都喜欢划一道界，这边是对的，那边是错的，站在道德制高点互相谩骂。因为对这个复杂的世界来说，这是一种很简单的理解方式，符合大部分人不爱思考的习惯。</p>
<p>理解并接受这个的世界，心境才会变得平和。它现在的样子就是它应该的样子，没有更好也没有更差，不期望它朝着自己认为的方向发展，就不会生出各种无妄的情绪，即是与这个世界和解。回到个人自身，也是一样。每个人的习惯，行为，情绪，都是当下自己的一种合理状态，没有更好也没有更差，既不自厌，也不自恋。但现实中却很难获得内心的安定，多数烦恼来自于想要让自己从当前状态到达另外一种状态，却又无法找到一条有效的途径。</p>
<p>练习是一种可以达成的手段，《刻意练习》里面提到，天才的要素：一个好的师傅，行之有效的练习方式，加上不断的在每次练习和重复的过程中有所进步。通过这种方式可以习得非常多且厉害的技能。当然大部分的人在一个领域能遇到一个好的师傅都已经非常幸运。但是有一点可以做到，就是在每次重复的过程中都有进步。所以，能够理解并接受自己当前的状态，找到目标状态的达成路径，朝着目标，不疾不徐，不为困难所动，不为环境所扰，是为与自己和解。</p>
<h1 id="做自己的英雄"><a href="#做自己的英雄" class="headerlink" title="#做自己的英雄"></a>#<font color="grey">做自己的英雄</font></h1><p>最近看了一个up主的视频，关于《千面英雄》。《千面英雄》总结了世界上各个文明的神话故事和英雄传说，得到的一个英雄的规律。大部分的英雄故事都可以在这样的框架下进行叙述。</p>
<blockquote>
<p>英雄的启程：离开原来的世界开始未知的冒险。要离开自己的舒适区，当然是拒绝的。这时候就需要外界助力，跨过第一道阈限。<br>踏上征程的英雄，经历考验之路，与女神相会，与天父和解，获得神性，得到恩赐。<br>消灭了终极boss的英雄，需要回到原来的世界。归来之路仍然需要外界的援助，跨越最终的阈限，获得生活的自由，起点亦是终点。</p>
</blockquote>
<p>神话是众人的梦，梦是众人的神话。梦境是现实生活的投射，而众人把内心的某种希冀投射到神话上，成为了这些流传最广的故事。具体到每个人，我们何尝不是在走自己的“英雄之路”。每一次都要鼓足勇气踏上征程，走出自己的舒适区，经历各种各样的考验。在披荆斩棘的过程中，对这个世界的认识愈加深刻。当我们完成了某种意义上的和解亦或是救赎，就会回归神性，获得恩赐。然后又回到起点，开始下一次的冒险。在这样不断的轮回中，个人获得了成长，变得通达，圆润。把握每一次的启程，历险，救赎，走自己的『英雄之路』。</p>
<blockquote>
<p>女神是抽象意义的，女性的形象源自于母亲，母亲孕育了这个世界，所以女神泛指这个世界运行的规律和基础。但如果看不清这个世界的本质，就会受到各种意象的诱惑，步入歧途。最终英雄历尽艰辛，站在了终极boss面前，但是却要『与天父和解』：『天父』是父亲的意象，象征着『暴君』和『主宰』，以及各种负面情绪的投射。英雄的目标不是消灭暴君父亲，而是消灭父亲的『执着面』。因为人各种欲望以及阴暗面无法简单的消灭，宗教的终极目是消灭生存意欲，而这并不能轻易能达到。英雄要与『父亲』和解，试着与这些阴暗的、负面的共存。和解之后，英雄便有了神性，会获得某种形式的恩赐。</p>
</blockquote>
<h1 id="No-one-is-comming"><a href="#No-one-is-comming" class="headerlink" title="#No one is comming"></a>#<font color="grey">No one is comming</font></h1><p>无人会来，初听会认为绝望，细品又会充满力量。婴儿时期至青少年时期，我们无法独自面对生活中的艰难困苦，需要求助于外界，家庭，父母，朋友，师长，潜意识中是有依赖的。依赖的反面是，当我们所依赖的对象无法给我们提供帮助的时候，便生发出各种负面情绪。成年了进入社会，必须要独自面对这个世界，却无法完成这种心态转换。期望公司完成自己的职业规划以及技能培训，期望找到另一半来像父母一样宠着自己包容自己，期望朋友能够为自己两肋插刀义无反顾，期望社会充满阳光、爱和正义。但现实却是，没有任何一个客体有任何义务为自己提供任何帮助或者达到自己假想的期望值，只有自己能为自己负责，因为生活是自己的。可以寻求外界助力，但责任是自己的，所以生活中的困苦和匮乏只能自己品尝，而不能转嫁到他人。理解了这一层，才有面对生活的勇气，因无路可退而一往无前。但长期形成的潜意识依赖很难在一两年改变，需要不断提醒自己“No one is comming”。</p>
<hr>
<font color="#cccccc">两个月了，打脸了打脸了……</font>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/04/2017-snippets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="阿来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Graphics Boy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/04/2017-snippets/" itemprop="url">2017年度小结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-04T00:00:00+08:00">
                2018-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-工作"><a href="#1-工作" class="headerlink" title="#1 工作"></a>#<font color="grey">1 工作</font></h1><p>九月份的某一天，回到家看线性代数，突然觉得那些公式变得非常清晰，很久没有这种一触即通，脑子透透的感觉了。之前很长的一段时间，想一些复杂的代码或算法，总觉得像是有一根针插在脑袋里阻断了某种思路，在迷雾中费力地寻找前方，事倍功半。现在一下子变得霍然开朗，或许是在在搬到新家心境不一样，也许是有某种神秘力量的加持，总之是一件很值得高兴的事情。</p>
<p>从三月份到八月份这半年忙于各种杂事，虚度过去了，还是自己还不够成熟吧。许多事情潜意识中在逃避，无可避免地表现在行为上，造成了很多不希望的结果。这之总是在想，都老大不小了，应该以什么姿态去面对生活。勇敢、担当、责任，这些词汇也不简单地只作为字面意思去理解，有了更多行为上的诠释。每一段经历，都有其必然发生的特性，值得去回味与思考。</p>
<p>以前写代码总是bug非常多，这跟自己急躁、缺乏耐心还有随性有很大关系。硬要强迫自己拧着性子去判断诸多可能产生的情况，然后每个情况都考虑到，收效甚微，这么久都没有完全纠正过来，想要违背本性是最难的。所以从16年末开始，就提醒自己尽量从架构和设计上避免出现bug，后续需求变化到一定程度之后就必须要重构。今年写代码的重点落在了前期设计上，在功能的初期和中期，都要思考最好的设计是怎样的（后期已经没办法修改了），想法完善了才去写代码或者重构。看了一些GamePlay相关的书籍，大抵有了总体上的把控。更加关注底层的运行机制，例如C#部分的CLR，Lua部分的虚拟机和jit，各个语言之间的交互以及数据传递。lua和C#，C#和C++，lua和C++。</p>
<p>值得高兴的是，今年终于找到了自己想要的工作状态，记住那种感觉，然后尽量保持。虽然来得有点晚，不过总算是有点样子了。那种掌握主动的感觉很美妙，主动地思考，主动的做事。气定神闲，不疾不徐。</p>
<h1 id="2-生活"><a href="#2-生活" class="headerlink" title="#2 生活"></a>#<font color="grey">2 生活</font></h1><p>去年看了《幸福课》之后，思考方式慢慢的发生了变化，其中有几个理论值得时时回味。</p>
<p><strong>积极心理学</strong>，学会关注积极的东西，任何事情都会有AB面，看到A面的同时也学会看到B面，从更积极的方向去思考去行动。</p>
<p><strong>神经的可塑性</strong>，大脑也是我们身上的一个器官，也会出现问题，只是经常出现问题我们自己无法察觉。它也像肌肉一样，锻炼会让它得到强化。经常熬夜会让它休息不够从而产生损伤，这些是逐渐变化的一个过程，经常无法察觉。在肌肉力量不够的时候，是很难感受到某一块肌肉力量的发力感的。同样，大脑力量不够的时候，也很难察觉自己脑子是处于一个什么样的状态。这其中，睡眠扮演了很重要的作用，下面会提到。</p>
<p><strong>改变</strong>，也是改变大脑的可塑性。改变也是一个缓慢的过程，这个过程不会是十天半月，至少也是三个月起步，然后是一年半载，长时间之后，再来看看达成了哪些改变。有这么一句话，听过了很多道理，依然过不好这一生。因为大部分的道理并没有经过大脑的仔细思考，而且思考一次两次也没有太大的作用，每天上下班的路上，喝下午茶的时候，都在脑子里回想一下这个道理对自己有什么用，怎么用在自己身上，要怎么去行动。重复半年，才会看到身上的起色。<strong>学会以年为单位去做事，去思考</strong>。</p>
<p><strong>感激、助人为乐</strong>，这两点是用来压制利己心和恶意心，这两种道德成分从长远来看是无法让自己很好的适应这个社会的，所以从改变认知的角度来讲，感激会让我们看到更多别人的优点，从而让自己更加快乐。帮助别人也是帮助我们自己，在自己周围形成一种互助的氛围。</p>
<p><strong>巅峰体验</strong>，人的状态是有起起伏伏的，每天思考一下自己的状态，比如说头脑很清晰，身体充满力量，记住处于峰值时的感觉，当状态回落的时候，回想之前的感觉，努力回到巅峰的状态。不断重复这个过程，就很容易察觉自己当前是什么状态，并且很快恢复到峰值状态。虽然也会有起起伏伏，但总体也是一个上扬的震荡线。</p>
<p><strong>允许自己为“人”</strong>，快乐和消极，高兴和忧伤。接受自己的不完美，接收自己的负面情绪，先去体验，然后再疏导。</p>
<p><strong>压力和休息</strong>，压力对我们是有好处的，问题不在于压力，在于你是否得到了充分的休息，是否恢复了精力。不要让自己一直处于疲惫的状态，充沛的精力能让我们更好地做事。</p>
<p><strong>运动和冥想</strong>，精神和肉体关系密切，记住大脑也是身体的一个器官，整个身体的健康程度也会影响到大脑的思考和认知。运动能让我们身体保持健康，充满活力。</p>
<p>以上这些构成了16年下半年和17年上半年的主题。到了17年中，各种事情使得自己并没有静下心来思考。进入17年下半年，终于有所回升，或许进入秋冬季之后整个人容易安静下来，抛开杂事更容易想得深远吧。</p>
<h1 id="3-读书"><a href="#3-读书" class="headerlink" title="#3 读书"></a>#<font color="grey">3 读书</font></h1><p>买了越来越多的书，虽然大部分书没有看完，不过书不能只看一遍或者看两遍就能理解其中三味。先通读一遍，以后遇到没想明白的地方，再翻出对应的章节品味一番，又会有不同的理解。今年的读书方向有两个，技术和人。</p>
<p>图形方面，PBR读了一半没有读完，有点汗颜，明年要加快节奏。然后还买了一堆GamePlay和编程基础相关的书籍，这两部分也需要不断巩固。游戏的架构和性能，GamePlay和游戏架构密不可分，完整地理解游戏各个部分的逻辑，才能写出好的设计。性能部分，要了解各个语言的机制（哪些用法比较低效，需要尽量避免，以及热点函数的优化）和程序底层的运行机制（《计算机程序的构造和解释》以及《CSAPP》）。虚拟机，大部分游戏都会内嵌一个脚本系统，也就是虚拟机，常用的有Lua和Python。对虚拟机的理解和优化，涉及到编译原理相关的内容。程序性能的优化，涉及到的内容非常广，也非常深，要不断地学习。</p>
<p>关于人的问题，心理学和哲学最能解惑了。心理学以具象的方式解读人的情绪，行为模式，思维方式；而哲学则对这些问题进行了形而上的解读。心理学的书籍看完了《亲密关系》，探讨了两性、朋友、家人这几种最常见的关系。两性从认识到相处，每个阶段会遇到的问题以及出现什么情况，都进行了细致的讨论。</p>
<p>哲学部分，读了叔本华的两本书：《论道德与自由》，《人生的智慧》。<code>人的总体命运是沉重和残酷的，那是挣扎、受苦和死亡的命运。一个人受的苦越多，就越早达到生活的真正目的，而一个人生活得越幸福，就越发延迟地到达这一目的。事实上，痛苦是一个净化的过程。在大多数情况下，人只有经过这一净化过程才会神圣化，亦即从生存意欲的苦海中回头</code>。人的意欲通过智力对这个表象世界的认知，表达在行为上。以前热衷于看到更大的世界，不过，看到了更大的世界，也就产生更多的欲望。不幸和痛苦正是来自无法回头的生存意欲，永远不会到达彼岸。人与人之间的矛盾也来自于各自生存意欲的碰撞。《人生的智慧》写于叔本华的晚年，在这个时期他对平庸的大众以及没有那么批判，算是简单易懂的大众读本。</p>
<h1 id="4-REL"><a href="#4-REL" class="headerlink" title="#4 REL"></a>#<font color="grey">4 REL</font></h1><p>八月份结束的那一天，友人跟我说：你终于完成了一年一次恋爱的任务。是啊，又结束了一段感情，在这其中挣扎良久，耗尽心力，曾经的笃定也成了幻影。两个人的生存意欲互相碰撞，没有让步，到底还是因为各自的性格。说起来，大概很多人都希望对方爱自己爱得要死，“你不能xxx，不能xxx，要你来做什么”，这类观点里面，“我”占据了太多比重，再加上自我服务偏差，事情就越来越无法挽回。在爱情里面能够做到真正无私的又有多少，大多就是搭个伙过日子罢。在自己真正达到某个阶段之前，还需要在苦海中再挣扎几年。</p>
<h1 id="5-睡眠"><a href="#5-睡眠" class="headerlink" title="#5 睡眠"></a>#<font color="grey">5 睡眠</font></h1><p>自己睡眠一直不太好，要么睡得很晚，要么半夜会醒，睡眠浅而且多梦。睡眠不好会降低大脑活性，严重影响认知，之前一直不太重视这个问题。从17年开始，尝试着怎么来调整睡眠质量。一开始尝试着冥想，然后将跑步时间挪到早上，避免晚上跑步之后太兴奋睡不着。然后晚上少喝水，避免早上被尿憋醒。后来买了泡沫轴，放松肩颈背。下半年买了个香薰机，加上甜橙的精油，意外的提升了睡眠质量，一觉到天明。关注睡眠质量，也许有意想不到的收获。</p>
<h1 id="6-健身"><a href="#6-健身" class="headerlink" title="#6 健身"></a>#<font color="grey">6 健身</font></h1><p>之前一直在跑步，对于核心力量的锻炼缺乏认识。发现了自己的驼背以及盆骨前倾之后，开始重视核心力量。以前睡觉会腰累，就是腰部力量过于缺乏还有盆骨前倾导致。办公室久坐会造成髂腰肌的长期收缩，盆骨前倾，腰累的同时也影响到体态。总之健康的状态是一个整体，某一部分的薄弱就会导致整个的状态不好，不能有短板。</p>
<h1 id="7-一些关键词"><a href="#7-一些关键词" class="headerlink" title="#7 一些关键词"></a>#<font color="grey">7 一些关键词</font></h1><p><strong>自我效能</strong>：平时的生活中要注重提升自我效能，亦即我“能”做某事。叔本华说人是不了解自己的，只有当他真正面临某些事情之后，他才知道自己到底会是什么反应，得到什么样的结果。只有经历过了很多事情，才知道自己到底是什么样子，自信也来源于此。主动地让自己面临不同的情况，处理各种事情。<br><strong>做事情以年为单位</strong>：不在着眼于短期的效益，坚持做某件事，至少也要等半年之后再看效果。</p>
<p><strong>……to be continued!</strong></p>
<hr>
<font color="#cccccc">终于有空把博客搭建起来了，在此立下flag，每个月至少写一篇文章！</font>








          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">阿来</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿来</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
